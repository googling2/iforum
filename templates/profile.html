{% extends 'base.html' %}

{% block content %}
<style>
  .profile-videos .video video {
    width: 300px;
    /* ì›í•˜ëŠ” ë„ˆë¹„ */
    height: 260px;
    /* ì›í•˜ëŠ” ë†’ì´ */
    object-fit: cover;
    /* ë¹„ë””ì˜¤ì˜ ë¹„ìœ¨ì„ ìœ ì§€í•˜ë©´ì„œ í¬ê¸°ë¥¼ ì¡°ì • */
  }

  /* ì´ë¯¸ì§€ ì—…ë¡œë“œ í¼ ìŠ¤íƒ€ì¼ */
  .profile-img-upload {
    display: none;
    /* ì´ˆê¸°ì—ëŠ” ìˆ¨ê¹€ */
    margin-top: 20px;
  }

  .profile-img-upload input[type="file"] {
    display: block;
    margin-bottom: 10px;
  }

  .profile-img-upload button {
    padding: 10px 20px;
    background-color: #4CAF50;
    color: white;
    border: none;
    cursor: pointer;
  }

  .video {
    position: relative;
    display: inline-block;
    margin: 10px;
  }

  .video-controls {
    display: flex;
    justify-content: space-between;
  }

  .like-btn,
  .delete-btn {
    padding: 5px 10px;
    font-size: 16px;
    cursor: pointer;
    border: none;
    background-color: #f1f1f1;
    border-radius: 5px;
  }


  .like-btn:hover,
  .delete-btn:hover {
    background-color: #ddd;
  }

  .profile .profile-videos .content {
    position: relative;
    width: 100%;
    height: 24rem;
  }
</style>

<section id="profile" class="box profile">
  <div class="top-header">
    <h3>frontend with salimi</h3>
    <div class="icons">
      <i class="fa-solid fa-shoe-prints"></i>
      <i class="fa-solid fa-bars"></i>
    </div>
  </div>
  <div class="profile-info">
    <div class="profile-img">
      <div class="inner-img">
        <img src="{{ profile_image }}" alt="Profile Image">
      </div>
      <h3>{{ user_info['name'] }}</h3>
    </div>

    <ul>
      <li>
        <h5>115</h5><a href="/gudog">
          <span>íŒ”ë¡œìš°</span>
        </a>
      </li>
      <li>
        <h5>3600</h5>
        <span>íŒ”ë¡œì›Œ</span>
      </li>
      <li>
        <h5>{{ total_likes }}</h5>
        <span>likes</span>
      </li>
    </ul>

    <div class="buttons">
      <button class="btn" id="profile-settings-button">í”„ë¡œí•„ì„¤ì •</button>
      <button class="sbbtn" id="subscription-button">êµ¬ë…</button>
      <button class="csbbtn" id="cancel-subscription-button">êµ¬ë…ì·¨ì†Œ</button>
    </div>

    <!-- ì´ë¯¸ì§€ ì—…ë¡œë“œ í¼ -->
    <div class="profile-img-upload" id="profile-img-upload">
      <form action="/upload_profile_image" method="post" enctype="multipart/form-data">
        <input type="file" name="profile_image" accept="image/*" required>
        <button type="submit">ì—…ë¡œë“œ</button>
      </form>
    </div>
  </div>
  <div class="profile-videos">
    <div class="content">
      <div class="videos-container">
        {% for fairytale in fairytales %}
        <div class="video">
          <video controls loop autoplay muted>
            <source src="{{ fairytale.ft_name }}" type="video/mp4">
          </video>
          <div class="video-controls">
            <button class="like-btn" id="like-btn-{{ fairytale.ft_code }}" onclick="toggleLike('{{ fairytale.ft_code }}')">
              ğŸ‘ Like
          </button>

          <button class="delete-btn" onclick="confirmDelete('{{ fairytale.ft_code }}')">ğŸ—‘ï¸</button>

          </div>
        </div>
        {% endfor %}
      </div>
    </div>
  </div>
</section>

<script>

function toggleLike(ftCode) {
    fetch(`/prolike/${ftCode}`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'Accept': 'application/json'
        }
    }).then(response => response.json())
      .then(data => {
          alert(`ì´ ì˜ìƒì˜ ì¢‹ì•„ìš” ìˆ˜: ${data.likes_count}`);
          // ì´ ë¶€ë¶„ì—ì„œ ë²„íŠ¼ì˜ í…ìŠ¤íŠ¸ë‚˜ ìŠ¤íƒ€ì¼ì„ ì—…ë°ì´íŠ¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
      }).catch(error => {
          console.error('ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤:', error);
      });
}

function confirmDelete(ftCode) {
    if (confirm("ì •ë§ë¡œ ì´ ë¹„ë””ì˜¤ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
        deleteVideo(ftCode);
    }
}

function deleteVideo(ftCode) {
    fetch(`/delete-video/${ftCode}`, {
        method: 'DELETE'
    }).then(response => {
        if (response.ok) {
            return response.json();
        }
        throw new Error('ì„œë²„ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ ë°œìƒ');
    }).then(data => {
        alert(data.message);  
        document.getElementById(`video-container-${ftCode}`).remove();  // ì •í™•í•œ ID ì‚¬ìš©
    }).catch(error => {
        console.error('ì˜¤ë¥˜ ë°œìƒ:', error);
        alert('ë¹„ë””ì˜¤ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');  // ì‚¬ìš©ìì—ê²Œ ë” ëª…í™•í•œ ì—ëŸ¬ ë©”ì‹œì§€ ì œê³µ
    });
}

  document.getElementById('profile-settings-button').addEventListener('click', function () {
    var uploadForm = document.getElementById('profile-img-upload');
    if (uploadForm.style.display === 'none' || uploadForm.style.display === '') {
      uploadForm.style.display = 'block';
    } else {
      uploadForm.style.display = 'none';
    }
  });

</script>
{% endblock content %}